#!/bin/bash
set -e

git config --global user.email "%new_email%"
git config --global user.name "%new_author%"
echo "New author: %new_author% <%new_email%>"

echo "Applying replacement rules..."
git commit --amend --author="%new_author% <%new_email%>" --no-edit


echo "Pushing changes to the target repository..."
git remote add origin-client %vcsroot.GitShadow_TestingSvelte_GitClient.url%

if [ %override_destination_branch% = "true" ]; then
    echo "Force push enabled. Overriding destination branch..."
    GIT_SSH_COMMAND="ssh -i ~/%vcsroot.GitShadow_TestingSvelte_GitClient.teamcitySshKey%" git push --force origin-client %git-shadow_branch%:%git-client_branch%
else
    git fetch --all
fi

echo "Done!"